<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyd Ynni</title>

    <link rel="stylesheet" type="text/css" href="style.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

    <!--[if IE]><script language="javascript" type="text/javascript" src="lib/flot/excanvas.min.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="lib/jquery-1.11.3.min.js"></script>
    <script language="javascript" type="text/javascript" src="lib/vis.helper.js"></script>
    <script language="javascript" type="text/javascript" src="lib/graph_bars.js"></script>
  </head>
  <body>
  
  <!-- OK TO USE? TAB ------------------------------------------------------->

  <div class="accordion" style="background-color:#29abe2"><div class="title">Status</div></div>
  <div id="oktouse" style="background-color:#29abe2" class="panel">
    <div class="panel-inner">
      <br><br>
      <p><b><span id="prclocal">--</span>%</b> local or off-peak power<br><span style="font-size:12px">In the last 7 days</span></p>
      <img id="star1" src="images/star20.png" style="width:45px">
      <img id="star2" src="images/star20.png" style="width:45px">
      <img id="star3" src="images/star20.png" style="width:45px">
      <img id="star4" src="images/star20.png" style="width:45px">
      <img id="star5" src="images/star20.png" style="width:45px">
      <p id="statusmsg"></p>
    </div>
  </div>
  
  <!-- TARIFF TAB ------------------------------------------------------->

  <div class="accordion" style="background-color:#1988b7"><div class="title">Saving</div></div>
  <div class="panel"  style="background-color:#1988b7">
    <div class="panel-inner">
      <p>You have used <b><span class="totalkwh"></span> kWh</b> in the last week<br>Costing <b>£<span class="totalcost"></span></b></p>
      <p>You have saved <b>£<span class="costsaving"></span></b> compared to standard flat rate price</p>
    </div>
  </div>
  
  <!-- HYDRO TAB ------------------------------------------------------->

  <div class="accordion" style="background-color:#146f95"><div class="title">Breakdown</div></div>
  <div class="panel" style="background-color:#146f95">
    <div class="panel-inner">
      <p><b>Your electricity use</b></p>
      <p><b><span class="hydrokwh">0</span> kWh</b> - Hydro Power: 7p/kWh</p>
      <p><b><span class="morningkwh"></span> kWh</b> - Morning Price (6am - 11am): 12p/kWh</p>
      <p><b><span class="middaykwh"></span> kWh</b> - Midday Price (11am - 4am): 10p/kWh</p>
      <p><b><span class="eveningkwh"></span> kWh</b> - Evening Price (4pm - 8pm): 14p/kWh</p>
      <p><b><span class="overnightkwh"></span> kWh</b> - Overnight Price (8pm - 6am): 7.25p/kWh</p>
    </div>
  </div>

  <!--------------------------------------------------------->
  <div class="icon-bar">
    <a class="active" href="#"><i class="fa fa-home"></i></a>
    <a href="#"><i class="fa fa-search"></i></a>
    <a href="#"><i class="fa fa-envelope"></i></a>
    <a href="#"><i class="fa fa-globe"></i></a>
    <a href="#"><i class="fa fa-trash"></i></a>
  </div>

  </body>
</html>

<script>

$.ajax({                                      
    url: "household/data",
    dataType: 'json',                  
    success: function(result) {
        var prc = Math.round(100*((result.overnightkwh + result.middaykwh) / result.totalkwh));
        $("#prclocal").html(prc);
        
        if (prc>20) $("#star1").attr("src","images/star.png");
        if (prc>40) setTimeout(function() { $("#star2").attr("src","images/star.png"); }, 100);
        if (prc>60) setTimeout(function() { $("#star3").attr("src","images/star.png"); }, 200);
        if (prc>80) setTimeout(function() { $("#star4").attr("src","images/star.png"); }, 300);
        if (prc>90) setTimeout(function() { $("#star5").attr("src","images/star.png"); }, 400);
        
        setTimeout(function() {
            if (prc<33) $("#statusmsg").html("You're missing out<br>HELP ME IMPROVE");
            if (prc>=33 && prc<66) $("#statusmsg").html("You're doing <b>OK</b>");
            if (prc>=66) $("#statusmsg").html("You're doing <b>GREAT</b>");
        }, 400);
        
        $(".morningkwh").html(result.morningkwh.toFixed(1));
        $(".middaykwh").html(result.middaykwh.toFixed(1));
        $(".eveningkwh").html(result.eveningkwh.toFixed(1));
        $(".overnightkwh").html(result.overnightkwh.toFixed(1));
        
        var totalcost = 0;
        totalcost += result.morningkwh * 0.12;
        totalcost += result.middaykwh * 0.10;
        totalcost += result.eveningkwh * 0.14;
        totalcost += result.overnightkwh * 0.0725;
        $(".totalcost").html(totalcost.toFixed(2));
        $(".totalkwh").html(result.totalkwh.toFixed(1));
        
        var totalcostflatrate = result.totalkwh * 0.12;
        var costsaving = totalcostflatrate - totalcost;
        $(".costsaving").html(costsaving.toFixed(1));
    } 
});

var panel_height = $(window).height() - 62*3 - 50;

$("#oktouse").show();
var height = $(window).height() - 62*3 - 50;
$("#oktouse").height(height);

$(".accordion").click(function() {
    // Hide and disable all panels
    $(".panel").attr("active",0);
    $(".panel").height(0);

    // Show only clicked panel
    panel_height = $(window).height() - 62*3 - 50;
    $(this).next().attr("active",1);
    $(this).next().height(panel_height);
});

$(window).resize(function(){
    panel_height = $(window).height() - 62*3 - 50;
    $(".panel[active=1]").height(panel_height);
});

</script>

